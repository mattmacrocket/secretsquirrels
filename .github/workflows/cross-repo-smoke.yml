name: Cross-Repo Smoke

on:
  push:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  smoke:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: Checkout orchestration repo
        uses: actions/checkout@v4

      - name: Ensure scripts are executable
        run: chmod +x ./scripts/bootstrap_repos.sh ./harness/smoke.sh

      - name: Bootstrap runtime repositories
        env:
          CLONE_PROTOCOL: https
          GH_ACCESS_TOKEN: ${{ secrets.CROSS_REPO_PAT }}
        run: ./scripts/bootstrap_repos.sh "${RUNNER_TEMP}/agent-repos"

      - name: Run cross-repo smoke harness
        run: ./harness/smoke.sh "${RUNNER_TEMP}/agent-repos"
